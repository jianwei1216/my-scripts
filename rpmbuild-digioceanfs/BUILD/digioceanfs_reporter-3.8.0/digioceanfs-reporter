#!/bin/sh
### BEGIN INIT INFO
# Provides:       digioceanfs-manager
# Required-Start: $remote_fs nfs-common $portmap $time
# Required-Stop:  $remote_fs nfs-common $portmap $time
# Default-Start:  2 3 4 5
# Default-Stop:   0 1 6
# Description:    Prepare for digioceanfs-manager
### END INIT INFO
PATH=/sbin:/bin:/usr/sbin:/usr/bin
WORKDIR=/usr/local/digioceanfs_manager
SYSTEMCTL=`which systemctl`
REPORTER=`which digioceanfs-reporter`
#. /lib/lsb/init-functions
#. /etc/init.d/functions

case "$1" in
  start)
    $SYSTEMCTL start snmpd
    $SYSTEMCTL start snmptrapd
    /sbin/mdadm --monitor --scan --daemonise --program=/usr/local/digiserver/mdadm.sh 1>/dev/null
    /usr/bin/python /usr/local/digiserver/digiserver.pyc start
        ;;
  stop)
    $SYSTEMCTL stop snmpd
    $SYSTEMCTL stop snmptrapd
    kill `pidof mdadm`
    pid=`cat /usr/local/digiserver/tmp/main.pid`
    kill $pid
        ;;
  restart)
   	$REPORTER stop
    $REPORTER start
    	;;
  *)
        echo "Usage: $0 {start|stop|restart}" >&2
        exit 1
        ;;
esac

exit 0
