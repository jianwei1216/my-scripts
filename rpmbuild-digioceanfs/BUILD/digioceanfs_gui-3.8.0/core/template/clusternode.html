$def with (content)

<div id="toolbar" class="ui-corner-all">
    <button id="btnclusternodecreate">$_("clusternodecreate")</button>
    <!--<button id="btnclusternodereplace">$_("clusternodereplace")</button>-->
    <button id="btnclusterset">$_("set")</button>
</div>

<div id="pcontent">

</div>
<script type="text/javascript">
    $(ELT)(function(){
        $(ELT)('#btnclusternodecreate').button({
            icons: {
                primary: 'ui-icon-plusthick'
            }
        }).bind('click',clusternodecreate);
        $(ELT)('#btnclusternodereplace').button({
            icons: {
                primary: 'ui-icon-gear'
            }
        }).bind('click',clusternodereplace);
        $(ELT)('#btnclusterset').button({
            icons: {
                primary: 'ui-icon-gear'
            }
        }).bind('click',clusterset);
        clusternodeload();
    });
    function clusternodeload(){
        var url = "/clusternodeload?" + new Date().getTime();
        checkSession();
        $(ELT).ajax({
            url: url,
            data: '',
            dataType: 'html',
            beforeSend: function(){
                custLoading("$_('Loading Data ...')");
            },
            success: function(text){
                $(ELT)('#loaddialog').dialog('close');
                $(ELT)('#pcontent').html(text);
            }
        });
    }
    function clusternodecreate(){
        $(ELT).ajax({
            type: 'GET',
            url: '/clusterdomaincheck',
            data: '',
            dataType: 'text',
            error: function () {
                custAlert("$_('operfail')", "Request Error!");
            },
            success: function (text) {
                if (text == '') {
                    custAlert("$_('operfail')", "$_('clusterdomainnamesetfirst')");
                    return false;
                }else{
                    custLoading("$_('Loading Data ...')");
                    var url = "/clusternodecreate?" + new Date().getTime();
                    checkSession();
                    var cnodedialog = $(ELT)('<div id="cnodedialog" title="$_('clusternodecreate')">').appendTo('body');
                    cnodedialog.load(
                        url,
                        '',
                        function (responseText, textStatus, XMLHttpRequest) {
                            $(ELT)('#loaddialog').dialog('close');
                            cnodedialog.dialog({
                                bgiframe: true,
                                autoOpen: true,
                                width: 340,
                                modal: true,
                                resizable: false,
                                buttons: {
                                    "$_('cancel')": function() {
                                        $(ELT)(this).dialog('close');
                                    },
                                    "$_('create')": function() {
                                        if(!$(ELT)('#formclusternode').valid()){
                                            return false;
                                        }
                                        var data = $(ELT)('#formclusternode').serialize();
                                        var ipaddr = $(ELT)('#clusternodeipaddr').val();
                                        if(ipaddr == ''){
                                            custAlert("$_('operfail')","$_('fillupclusternodeipaddr')");
                                            $(ELT)(this).dialog('close');
                                        }
                                        else{
                                            $(ELT).ajax({
                                                url: url,
                                                type: 'POST',
                                                data: data,
                                                dataType: 'text',
                                                beforeSend: function(){
                                                    custLoading("$_('creatingnodenow')");
                                                },
                                                error: function(){
                                                    custAlert("$_('operfail')","Request Error!");
                                                },
                                                success: function(text){
                                                    if(isNaN(text)){
                                                        $(ELT)('#loaddialog').dialog('close');
                                                        custAlert("$_('operfail')",text);
                                                    }
                                                    else{
                                                        if(parseInt(text) == 0){
                                                            clusternodeload();
                                                            $(ELT)('#loaddialog').dialog('close');
                                                            custAlert("$_('opersucc')","$_('clusternodecreatesucc')");
                                                        }else if(parseInt(text) == 11134){
                                                            $(ELT)('#loaddialog').dialog('close');
                                                            custAlert("$_('operfail')","$_('clusterdomainnamesetfirst')");
                                                        }else{
                                                            $(ELT)('#loaddialog').dialog('close');
                                                            custAlert("$_('operfail')","$_('operfailinfo')");
                                                        }
                                                    }
                                                }
                                            });
                                            $(ELT)(this).dialog('close');
                                        }
                                    }
                                },
                                close: function(){
                                    cnodedialog.remove();
                                }
                            });
                        }
                    );
                }
            }
        });
    }
    function clusternodereplace(){
		custLoading("$_('Loading Data ...')");
        var url = "/clusternodereplace?" + new Date().getTime();
        checkSession();
        var rnodedialog = $(ELT)('<div id="rnodedialog" title="$_('clusternodereplace')">').appendTo('body');
        rnodedialog.load(
            url, 
            '',
            function (responseText, textStatus, XMLHttpRequest) {
				$(ELT)('#loaddialog').dialog('close');
                rnodedialog.dialog({
                    bgiframe: true,
                    autoOpen: true,
                    width: 340,
                    modal: true,
                    resizable: false,
                    buttons: {
                        "$_('cancel')": function() {
                            $(ELT)(this).dialog('close');
                        },
                        "$_('replace')": function() {
                            var data = $(ELT)('#formclusternode').serialize();
                            var ipaddr = $(ELT)('#clusternodenew').val();
                            if(ipaddr == ''){
                                custAlert("$_('operfail')","$_('fillupclusternodeipaddr')");
                                $(ELT)(this).dialog('close');
                            }
                            else{
                                rnodedialog.dialog('close');
                                custWarning("$_('confirmoper')","$_('clusternodereplaceconfirm')",'',function(){
                                    $(ELT).ajax({
                                        url: url,
                                        type: 'POST',
                                        data: data,
                                        dataType: 'text',
                                        beforeSend: function(){
                                            custLoading("$_('replacingnodenow')");
                                        },
                                        error: function(){
                                            custAlert("$_('operfail')","Request Error!");
                                        },
                                        success: function(text){
                                            if(isNaN(text)){
                                                $(ELT)('#loaddialog').dialog('close');
                                                custAlert("$_('operfail')",text);
                                            }
                                            else{
                                                if(parseInt(text) == 0){
                                                    clusternodeload();
                                                    $(ELT)('#loaddialog').dialog('close');
                                                    custAlert("$_('opersucc')","$_('clusternodereplacesucc')");
                                                }else{
                                                    custAlert("$_('operfail')","$_('operfailinfo')");
                                                }
                                            }
                                        }
                                    });
                                    $(ELT)(this).dialog('close');
                                });
                            }
                        }
                    },
                    close: function(){
                        rnodedialog.remove();
                    }
                });
            }
        );
    }
    function clusternoderestart(clusternodename,clusternodestatus){
        var url = '/clusternoderestart?' + new Date().getTime();
        checkSession();
        var currnodeallip = [];
        var initdialog = $(ELT)('<div id="initdialog" title="$_('clusternodeinit')">').appendTo('body');
        initdialog.load(
                url, 
                'clusternodestatus=' + clusternodestatus,
                function (responseText, textStatus, XMLHttpRequest) {
                    //$(ELT)('#loaddialog').dialog('close');
                    initdialog.dialog({
                        bgiframe: true,
                        autoOpen: true,
                        width: 280,
                        modal: true,
                        resizable: false,
                        buttons: {
                            "$_('cancel')": function() {
                                $(ELT)(this).dialog('close');
                            },
                            "$_('confirm')": function() {
                                var initlevel = $(ELT)("input[name=initOption]:checked").val();
                                $(ELT).ajax({
                                    type:'GET',
                                    url:'/clustergetnodeallip',
                                    data:'clusternodename=' + clusternodename,
                                    dataType:'JSON',
                                    error: function(){
                                        custAlert("$_('operfail')","Request Error!");
                                    },
                                    success:function(text){
                                        var currnodeallip = text;
                                        var data = 'clusternodename=' + clusternodename + '&initlevel=' + initlevel;
                                        $(ELT).ajax({
                                            url: url,
                                            type: 'POST',
                                            data: data,
                                            dataType: 'text',
                                            error: function(){
                                                custAlert("$_('operfail')","Request Error!");
                                            },
                                            success: function(text){
                                                if(isNaN(text)){
                                                    custAlert("$_('operfail')",text);
                                                }
                                                else{
                                                    if(parseInt(text) == 0){
                                                        if($(ELT).inArray(location.hostname,currnodeallip) >= 0){
                                                            custAlert("$_('opersucc')","$_('clustercurrnodeinitsucc')");
                                                        }else{
                                                            custAlert("$_('opersucc')","$_('clusternodeinitsucc')");
                                                            clusternodeload();
                                                        }
                                                    }else{
                                                        $(ELT)('#loaddialog').dialog('close');
                                                        custAlert("$_('operfail')","$_('operfailinfo')");
                                                    }
                                                }
                                            }
                                        });
                                    }
                                });
                                $(ELT)(this).dialog('close');
                            }
                        },
                        close: function(){
                            initdialog.remove();
                    }
                });
            }
        );
    }
    function clusternodeipmiset(clusternodename){
		custLoading("$_('Loading Data ...')");
        var url = "/clusternodeipmiset?" + new Date().getTime();
        checkSession();
        var isdialog = $(ELT)('<div id="isdialog" title="$_('ipmiset')">').appendTo('body');
        isdialog.load(
            url, 
            'clusternodename=' + clusternodename,
            function (responseText, textStatus, XMLHttpRequest) {
				$(ELT)('#loaddialog').dialog('close');
                isdialog.dialog({
                    bgiframe: true,
                    autoOpen: true,
                    width: 360,
                    modal: true,
                    resizable: false,
                    buttons: {
                        "$_('cancel')": function() {
                            $(ELT)(this).dialog('close');
                        },
                        "$_('set')": function() {
                            if(!$(ELT)('#formclusternodeipmi').valid()){
                                return false;
                            }
                            var data = $(ELT)('#formclusternodeipmi').serialize();
                            $(ELT).ajax({
                                url: url,
                                type: 'POST',
                                data: data+'&clusternodename='+clusternodename,
                                dataType: 'text',
                                beforeSend: function(){
                                    custLoading("$_('clusternodeipmisettingnow')");
                                },
                                error: function(){
                                    custAlert("$_('operfail')","Request Error!");
                                },
                                success: function(text){
                                    if(isNaN(text)){
                                        $(ELT)('#loaddialog').dialog('close');
                                        custAlert("$_('operfail')",text);
                                    }else{
                                        if(parseInt(text) == 0){
                                            clusternodeload();
                                            $(ELT)('#loaddialog').dialog('close');
                                            custAlert("$_('opersucc')","$_('clusternodeipmisetsucc')");
                                        }else{
                                            custAlert("$_('operfail')","$_('operfailinfo')");
                                        }
                                    }
                                }
                            });
                            $(ELT)(this).dialog('close');
                        }
                    },
                    close: function(){
                        isdialog.remove();
                    }
                });
            }
        );
    }
    function clusternodedeletesingle(clusternodeipaddr){
        var url = '/clusternodedeletesingle?' + new Date().getTime();
        checkSession();
		if(window.location.toString().match(/(?:\d+\.){3}(?:\d+)/)==$(ELT)("#nodeip_"+clusternodeipaddr).html()&&$(ELT)("#cluternodes tbody tr").length>1){
			custAlert("$_('operfail')","请先删本机外的其他节点！");
			return false;
		}
        var buttons = {
            "$_('cancel')": function() {
                $(ELT)(this).dialog('close');
            },
            "$_('delete')": function() {
                $(ELT)(this).dialog('close');
                checkSession();
                $(ELT).ajax({
                    url: url,
                    type: 'POST',
                    data: 'clusternodeipaddr=' + clusternodeipaddr,
                    dataType: 'text',
                    beforeSend: function(){
                        custLoading("$_('deletingnodenow')");
                    },
                    error: function(){
                        custAlert("$_('operfail')","Request Error!");
                    },
                    success: function(text){
                        if(isNaN(text)){
                            $(ELT)('#loaddialog').dialog('close');
                            custAlert("$_('operfail')",text);
                        }
                        else{
                            if(parseInt(text) == 0){
                                clusternodeload();
                                $(ELT)('#loaddialog').dialog('close');
                                custAlert("$_('opersucc')","$_('clusternodedeletesucc')");
                            }else{
                                custAlert("$_('operfail')","$_('operfailinfo')");
                            }
                        }
                    }
                });
            }
        };
        custwarning("$_('confirmoper')","$_('clusternodedeleteconfirm')",buttons);
    }
    
    function clusternodecifsrestart(clusternodename,clustercifsstatus, clusternodestatus){
    	var url = "/clusternodecifsrestart?" + new Date().getTime();
    	checkSession();
    	$(ELT).ajax({
                url: url,
                type: 'POST',
                data: 'clusternodename=' + clusternodename,
                dataType: 'text',
                beforeSend: function(){
                	if(clusternodestatus == 'stop'){
                		custAlert("$_('operfail')","$_('startnodefirst')");
                		return false;
                	}
                    if(clustercifsstatus == 'stop'){
                        custLoading("$_('nowstartingcifs')");
                    }else{
                        custLoading("$_('restartingcifsnow')");
		    }
                },
                error: function(){
                    custAlert("$_('operfail')","Request Error!");
                },
                success: function(text){
                    if(isNaN(text)){
                        $(ELT)('#loaddialog').dialog('close');
                        custAlert("$_('operfail')",text);
                    }
                    else{
                        if(parseInt(text) == 0){
                            clusternodeload();
                            $(ELT)('#loaddialog').dialog('close');
                            if(clustercifsstatus == 'stop'){
                                custAlert("$_('opersucc')","$_('clusternodecifsstartsucc')");
			    }else{
                                custAlert("$_('opersucc')","$_('clusternodecifsrestartsucc')");
                            }
                        }
                        else{
                            custAlert("$_('operfail')","$_('operfailinfo')");
                        }
                    }
                }
            });
    }
    function clusternodenfsrestart(clusternodename){
    	var url = "/clusternodenfsrestart?" + new Date().getTime();
    	checkSession();
    	$(ELT).ajax({
                url: url,
                type: 'POST',
                data: 'clusternodename=' + clusternodename,
                dataType: 'text',
                beforeSend: function(){
                    custLoading("$_('restartingnfsnow')");
                },
                error: function(){
                    custAlert("$_('operfail')","Request Error!");
                },
                success: function(text){
                    if(isNaN(text)){
                        $(ELT)('#loaddialog').dialog('close');
                        custAlert("$_('operfail')",text);
                    }
                    else{
                        if(parseInt(text) == 0){
                            clusternodeload();
                            $(ELT)('#loaddialog').dialog('close');
                            custAlert("$_('opersucc')","$_('clusternodenfsrestartsucc')");
                        }
                        else{
                            custAlert("$_('operfail')","$_('operfailinfo')");
                        }
                    }
                }
            });
    }
    function clusterset(){
        custLoading("$_('Loading Data ...')");
        var url = "/clusterset?" + new Date().getTime();
        checkSession();
        var csetdialog = $(ELT)('<div id="csetdialog" title="$_('set')">').appendTo('body');
        csetdialog.load(
            url, 
            '',
            function (responseText, textStatus, XMLHttpRequest) {
                $(ELT)('#loaddialog').dialog('close');
                csetdialog.dialog({
                    bgiframe: true,
                    autoOpen: true,
                    width: 540,
                    modal: true,
                    resizable: false,
                    buttons: {
                        "$_('confirm')": function() {
                            $(ELT)(this).dialog('close');
                        }
                    },
                    close: function(){
                        csetdialog.remove();
                    }
                });
            }
        );
    }
</script>
