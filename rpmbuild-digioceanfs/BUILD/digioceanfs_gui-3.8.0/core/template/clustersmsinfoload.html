$def with (content)

<div class="mess-info ui-state-highlight ui-corner-all" style="margin:15px;line-height:25px;">
    <p>
        <span class="info-icon ui-icon ui-icon-info"></span>
		<strong>$_("tips"):</strong> $_("clustersmssetinfos")<br />
        <span class="info-icon ui-icon ui-icon-info"></span>
		<strong>$_("tips"):</strong> $_("clustersmssettips")
    </p>
</div>
<form id="clustersmsset" method="post">
    <fieldset>
        <label for="clustersmsp">$_("clustersmsp")</label>
        $if content.fsmsp:
            <span>$content.smsinfos['smsp']</span><br /><br />
        $else:
            $if 'smsp' in content.smsinfos and content.smsinfos['smsp']:
                <input type="text" style="width:130px" id="clustersmsp" name="clustersmsp" value="$content.smsinfos['smsp']" class="ui-widget-content ui-corner-all" />
            $else:
                <input type="text" style="width:130px" id="clustersmsp" name="clustersmsp" class="ui-widget-content ui-corner-all" />
            <a title="$_('save')" style="color:#0066AA;padding-left:20px;text-decoration:none" href="javascript:void(0);" onClick="clustersmspsave();">$_("save")</a><br /><br />

        <label for="clustermobp">$_("clustermobp")</label>
        +86<input style="width:105px" type="text" id="clustermobp" name="clustermobp" class="ui-widget-content ui-corner-all" />
		<button id="clusteraddmobp" type="button">$_("add")</button><br /><br />
		<div style="display:inline-block;margin-left:120px;" id="clusternodemobp">
        
		</div><br /><br />
        <label for="fstatus">$_("funcstatus")</label>

        $if 'inuse' in content.smsinfos and content.smsinfos['inuse']:
            <span id="smsstatusspan">$_("enabled")</span>
            <a title="$_('disable')" id="smsstatusa" name="disable" style="color:#0066AA;padding-left:20px;text-decoration:none" href="javascript:void(0);" onClick="clustersmschangestatus($(ELT)(this).attr('name'));">$_("disable")</a><br /><br />
        $else:
            <span id="smsstatusspan">$_("disabled")</span>
            <a title="$_('enable')" id="smsstatusa" name="enable" style="color:#0066AA;padding-left:20px;text-decoration:none" href="javascript:void(0);" onClick="clustersmschangestatus($(ELT)(this).attr('name'));">$_("enable")</a><br /><br />
        <label for="clusternotifytype">$_("clusternotifyevnet")</label>
        <div style="margin-left:130px;">
            $if 'ntype' in content.smsinfos and content.smsinfos['ntype']:
                <span id="clusternotifytype" style="display:none">$content.smsinfos['ntype']</span>
            $else:
                <span id="clusternotifytype" style="display:none"></span>
            <ul id="notifyTypetreeDemo" class="ztree"></ul>
            <a title="$_('save')" style="color:#0066AA;text-decoration:none" href="javascript:void(0);" onClick="clusternotifytypesave();">$_("save")</a><br /><br />
        </div>
    </fieldset>
</form>
</style>
<script type="text/javascript">
    var setting = {
        check: {
            enable: true,
            chkStyle: "checkbox"
        },
        data: {
            simpleData: {
                enable: true
            }
        }
    };
    var zNodes =[
        { id:1, pId:0, name:'$_("RaidEvent")', opkey:"RaidEvent"},
        { id:11, pId:1, name:'$_("FailSpare")', opkey:"FailSpare"},
        { id:12, pId:1, name:'$_("RebuildStarted")', opkey:"RebuildStarted"},
        { id:13, pId:1, name:'$_("RebuildFinished")', opkey:"RebuildFinished"},
        { id:14, pId:1, name:'$_("SpareActive")', opkey:"SpareActive"},
        { id:15, pId:1, name:'$_("NewArray")', opkey:"NewArray"},
        { id:16, pId:1, name:'$_("DeviceDisappeared")', opkey:"DeviceDisappeared"},
        { id:17, pId:1, name:'$_("raiddegraded")', opkey:"degraded"},
        { id:18, pId:1, name:'$_("raidfail")', opkey:"FAILED"},
        { id:2, pId:0, name:'$_("DiskEvent")', opkey:"DiskEvent"},
        { id:21, pId:2, name:'$_("DiskAdd")', opkey:"add"},
        { id:22, pId:2, name:'$_("DiskRemove")', opkey:"remove"},
        { id:23, pId:2, name:'$_("DiskTemp")', opkey:"DiskTemp"},
        { id:3, pId:0, name:'$_("NetLink")', opkey:"NetLink"},
        { id:31, pId:3, name:'$_("Off-line")', opkey:"Off-line"},
        { id:32, pId:3, name:'$_("On-line")', opkey:"On-line"},
        { id:33, pId:3, name:'$_("SpeedDown")', opkey:"SpeedDown"},
        { id:34, pId:3, name:'$_("SpeedResume")', opkey:"SpeedResume"},
        { id:4, pId:0, name:'$_("FileSystemEvent")', opkey:"FileSystemEvent"},
        { id:41, pId:4, name:'$_("recover")', opkey:"ok"},
        { id:42, pId:4, name:'$_("notice")', opkey:"notice"},
        { id:43, pId:4, name:'$_("warning")', opkey:"warning"},
        { id:44, pId:4, name:'$_("error")', opkey:"error"},
        { id:5, pId:0, name:'$_("SysMsg")', opkey:"SysMsg"},
        { id:51, pId:5, name:'$_("usedcpu")', opkey:"usedcpu"},
        { id:52, pId:5, name:'$_("cputemp")', opkey:"cputemp"},
        { id:53, pId:5, name:'$_("usedmem")', opkey:"usedmem"},
        { id:54, pId:5, name:'$_("cpufan")', opkey:"cpufan"},
    ];
    $(ELT)(function(){
        $(ELT)('button').button();
        $(ELT).fn.zTree.init($(ELT)("#notifyTypetreeDemo"), setting, zNodes);
		$(ELT)('#clusteraddmobp').button({
			icons: {
				primary: 'ui-icon-plusthick'
			}
		}).bind('click',clusternodeaddmobp);
        var treeObj = $(ELT).fn.zTree.getZTreeObj("notifyTypetreeDemo");
        var allnodes = treeObj.transformToArray(treeObj.getNodes());
        var opkeys = $(ELT)("#clusternotifytype").html().Trim().split(',');
        for(i=0;i<allnodes.length;i++){
            if($(ELT).inArray(allnodes[i].opkey,opkeys) >= 0){
                treeObj.checkNode(allnodes[i],true,true);
            }
        }
        clusternodemobpload();
    });
    function clusternodemobpload(){
        var url = "/clusternodemobpload?" + new Date().getTime();
        $(ELT)('#clusternodemobp').load(url,'');
    }
    function clusternodeaddmobp(){
        if($(ELT)('#clustermobp').val().length == 0){
            custAlert("$_('operfail')","$_('mobpmustnotnull')");
            return false;
        }
        if($(ELT)('#clustermobp').val().length > 0){
            var re=/^\d{11}$(ELT)/;
            var mobp = $(ELT)("#clustermobp").val().Trim();
            if(!re.test(mobp)){
                custAlert("$_('operfail')","$_('filluprightmobp')");
                return false;
            }
        }
        $(ELT).ajax({
            url: '/clusternodeaddmobp',
            type: 'POST',
            data: 'clustermobp=' + $(ELT)('#clustermobp').val().Trim(),
            dataType: 'text',
            beforeSend: function(){
                custLoading("$_('clusteraddmobpnow')");
            },
            error: function(){
                custAlert("$_('operfail')","Request Error!");
            },
            success: function(text){
                if(isNaN(text)){
                    $(ELT)('#loaddialog').dialog('close');
                    custAlert("$_('operfail')",text);
                }else{
                    if(parseInt(text) == 0){
                        clusternodemobpload();
                        $(ELT)('#loaddialog').dialog('close');
                        custAlert("$_('opersucc')","$_('clusternodeaddmobpsucc')");
                    }else{
                        custAlert("$_('operfail')","$_('operfailinfo')");
                    }
                }
            }
        });
    }
    function clusternodedelmobp(clustermobp){
        var url = "/clusternodedelmobp?" + new Date().getTime();
        clustermobp = clustermobp.replace(/\+/g, "%2B");
        $(ELT).ajax({
            url: url,
            type: 'POST',
            data: 'clustermobp=' + clustermobp,
            dataType: 'text',
            beforeSend: function(){
                custLoading("$_('clusterdelmobpnow')");
            },
            error: function(){
                custAlert("$_('operfail')","Request Error!");
            },
            success: function(text){
                if(isNaN(text)){
                    $(ELT)('#loaddialog').dialog('close');
                    custAlert("$_('operfail')",text);
                }else{
                    if(parseInt(text) == 0){
                        clusternodemobpload();
                        $(ELT)('#loaddialog').dialog('close');
                        custAlert("$_('opersucc')","$_('clusternodedelmobpsucc')");
                    }else{
                        custAlert("$_('operfail')","$_('operfailinfo')");
                    }
                }
            }
        });
        //custConfirm("$_('confirmoperation')","$_('confirmdelmobp')",buttons);
    }
    function clustersmspsave(){
        var url = "/clustersmspsave?" + new Date().getTime();
        var clustersmsp = $(ELT)('#clustersmsp').val().Trim();
        if(clustersmsp.length == 0){
            custAlert("$_('operfail')","$_('smspmustnotnull')");
            return false;
        }
        if(clustersmsp.length > 0){
            var re=/^\+86\d{11}$(ELT)/;
            if(!re.test(clustersmsp)){
                custAlert("$_('operfail')","$_('filluprightsmsp')");
                return false;
            }
        }
        clustersmsp = clustersmsp.replace(/\+/g, "%2B");
        $(ELT).ajax({
            url: url,
            type: 'POST',
            data: 'clustersmsp=' + clustersmsp,
            dataType: 'text',
            beforeSend: function(){
                custLoading("$_('clustersmspsavenow')");
            },
            error: function(){
                custAlert("$_('operfail')","Request Error!");
            },
            success: function(text){
                if(isNaN(text)){
                    $(ELT)('#loaddialog').dialog('close');
                    custAlert("$_('operfail')",text);
                }else{
                    if(parseInt(text) == 0){
                        $(ELT)('#loaddialog').dialog('close');
                        custAlert("$_('opersucc')","$_('clustersmspsavesucc')");
                    }else{
                        custAlert("$_('operfail')","$_('operfailinfo')");
                    }
                }
            }
        });
    }

    function clustersmschangestatus(cstatus){
        var url = "/clustersmschangestatus?" + new Date().getTime();
        $(ELT).ajax({
            url: url,
            type: 'POST',
            data: 'cstatus=' + cstatus,
            dataType: 'text',
            beforeSend: function(){
                if(cstatus == 'enable'){
                    custLoading("$_('clustersmsenablesnow')");
                }else{
                    custLoading("$_('clustersmsdisablesnow')");
                }
            },
            error: function(){
                custAlert("$_('operfail')","Request Error!");
            },
            success: function(text){
                if(isNaN(text)){
                    $(ELT)('#loaddialog').dialog('close');
                    custAlert("$_('operfail')",text);
                }else{
                    if(parseInt(text) == 0){
                        $(ELT)('#loaddialog').dialog('close');
                        custAlert("$_('opersucc')","$_('clustersmschangestatussucc')");
                        if(cstatus == 'enable'){
                            $(ELT)('#smsstatusspan').html('$_("enabled")');
                            $(ELT)('#smsstatusa').html('$_("disable")');
                            $(ELT)('#smsstatusa').attr('name','disable');
                        }else{
                            $(ELT)('#smsstatusspan').html('$_("disabled")');
                            $(ELT)('#smsstatusa').html('$_("enable")');
                            $(ELT)('#smsstatusa').attr('name','enable');
                        }
                    }else{
                        custAlert("$_('operfail')","$_('operfailinfo')");
                    }
                }
            }
        });  
    }
    function clusternotifytypesave(){
        var clusternotifytypes = new Array();
        var url = "/clusternotifytypesave?" + new Date().getTime();
        var ntypes = $(ELT).fn.zTree.getZTreeObj("notifyTypetreeDemo").getCheckedNodes(true);
        $(ELT)(ntypes).each(function(){
            clusternotifytypes.push($(ELT)(this).attr('opkey'));                  
        })
        $(ELT).ajax({
            url: url,
            type: 'POST',
            data: 'clusternotifytypes=' + clusternotifytypes,
            dataType: 'text',
            beforeSend: function(){
                custLoading("$_('clusternotifytypesavenow')");
            },
            error: function(){
                custAlert("$_('operfail')","Request Error!");
            },
            success: function(text){
                if(isNaN(text)){
                    $(ELT)('#loaddialog').dialog('close');
                    custAlert("$_('operfail')",text);
                }else{
                    if(parseInt(text) == 0){
                        $(ELT)('#loaddialog').dialog('close');
                        custAlert("$_('opersucc')","$_('clusternotifytypesavesucc')");
                    }else{
                        custAlert("$_('operfail')","$_('operfailinfo')");
                    }
                }
            }
        });
    }
</script>
